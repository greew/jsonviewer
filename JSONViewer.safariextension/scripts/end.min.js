/*

 Copyright (c) 2015, Jesper Skytte Hansen <jesper@skytte.it>
 All rights reserved.
 See license located in docs/LICENSE.txt
*/
(function(){function b(){this.body=document.body;if(!(-1<document.location.hash.indexOf("raw"))){var a=this.u();if(!1!==a&&(a=a.textContent,a=this.o(a)||this.s(a),!1!==a)){try{a.json=JSON.parse(a.json)}catch(d){return}this.D(a);this.H()}}}b.prototype.u=function(){if(1!=this.body.childNodes.length)return!1;var a=this.body.childNodes[0];return"pre"!=a.tagName.toLowerCase()?!1:a};b.prototype.o=function(a){a=a.trim();var d=a.charAt(0);return"{"==d||"["==d?{json:a}:!1};b.prototype.s=function(a){return(a=
a.match(/^\s*([^\(]+)\((([{\[])(.*)([}\]]))\)(;)?$/))?{json:a[2],j:a[1],I:a[6]?!0:!1}:!1};b.prototype.D=function(a){this.style=this.createElement("link");this.style.setAttribute("rel","stylesheet");this.style.setAttribute("type","text/css");this.style.setAttribute("media","all");this.style.setAttribute("href",safari.extension.baseURI+"styles/style.css");this.buttons=this.A();this.b=this.createElement("div","prettified","Loading...");this.c=this.body.firstChild;this.c.hidden=!0;var d=this.createElement("div",
"root",[this.style,this.buttons,this.b,this.c]);this.body.appendChild(d);this.b.textContent="";this.append(this.b,this.functionName(a,this.value(a.json)))};b.prototype.functionName=function(a,d){var e=void 0!==a.j,c=this.createDocumentFragment();e&&this.append(c,this.createElement("div","type function",a.j+"("));this.append(c,d);e&&this.append(c,")");return c};b.prototype.value=function(a){var d=this.a(a);switch(d){case "object":return this.B(a);case "array":return this.w(a);case "null":case "number":case "string":case "boolean":return this.C(a,
d)}return null};b.prototype.B=function(a){var d=0,e=[],c;for(c in a)if(a.hasOwnProperty(c)){var b=this.a(a[c]),b="object"===b||"array"===b;d++;var f=null,h="";b&&(f=this.createElement("span","collapser"),h="collapsible expanded",f.addEventListener("click",this.g.bind(this)));e.push(this.createElement("li",h,[f,'"',this.createElement("span","key",c),'"',this.createElement("span","colon",":"),this.value(a[c]),this.createElement("span","comma",",")]))}return this.createDocumentFragment("{",this.createElement("ul",
"object onlyExpanded",e),this.createElement("span","onlyCollapsed","..."),"}",this.createElement("span","numHiddenElements onlyCollapsed","("+d+" hidden elements)"))};b.prototype.w=function(a){for(var d=[],b=a.length,c=0;c<b;c++){var g=this.a(a[c]),f=null,h="";if("object"===g||"array"===g)f=this.createElement("span","collapser"),h="collapsible expanded",f.addEventListener("click",this.g.bind(this));d.push(this.createElement("li",h,[f,this.value(a[c]),this.createElement("span","comma",",")]))}return this.createDocumentFragment("[",
this.createElement("ul","array onlyExpanded",d),this.createElement("span","onlyCollapsed","..."),"]",this.createElement("span","numHiddenElements onlyCollapsed","("+b+" hidden elements)"))};b.prototype.C=function(a,d){var b;switch(d){case "number":b=a+"";break;case "string":b='"'+a+'"';break;case "boolean":b=a?"true":"false";break;case "null":b="null"}return this.createElement("span","type "+d,b)};b.prototype.A=function(){this.h=this.createElement("button",null,"Show original/prettified JSON");this.i=
this.createElement("button",null,"Collapse/Expand all");return this.createElement("div","buttons",[this.h,this.i])};b.prototype.m=function(){this.c.hidden=!this.c.hidden;this.b.hidden=!this.b.hidden};b.prototype.g=function(a){a=a.target.parentElement;this.l(a)?this.collapse(a):this.expand(a)};b.prototype.collapse=function(a){this.f(a,"expanded","collapsed")};b.prototype.expand=function(a){this.f(a,"collapsed","expanded")};b.prototype.v=function(){for(var a=document.querySelectorAll(".collapsible"),
d=a.length,b,c=0;c<d;c++)0==c&&(b=this.l(a[c])),b?this.collapse(a[c]):this.expand(a[c])};b.prototype.a=function(a){var b=typeof a;switch(b){case "object":if(null===a)return"null";switch(typeof a.length){case "undefined":return"object";case "number":return"array"}}return b};b.prototype.H=function(){this.h.addEventListener("click",this.m.bind(this));this.i.addEventListener("click",this.v.bind(this))};b.prototype.createElement=function(a,b,e){a=document.createElement(a);b&&this.G(a,b);if(e){"array"!=
this.a(e)&&(e=[e]);b=e.length;for(var c=0;c<b;c++){var g=e[c],f=this.a(g);if("null"!==f){if("string"===f||"number"===f)g=document.createTextNode(g+"");a.appendChild(g)}}}return a};b.prototype.createDocumentFragment=function(a){var b=document.createDocumentFragment();this.append.apply(this,[b].concat([].slice.call(arguments)));return b};b.prototype.append=function(a,b){for(var e=arguments.length,c=1;c<e;c++){var g=arguments[c],f=this.a(g);if("null"!==f){if("string"===f||"number"===f)g=document.createTextNode(g+
"");a.appendChild(g)}}return a};b.prototype.l=function(a){return-1<a.className.indexOf("expanded")};b.prototype.G=function(a,b){a.className=b};b.prototype.F=function(a,b,e){var c=a.className.split(" ");b=c.indexOf(b);-1<b&&c.splice(b,1,e);a.className=c.join(" ")};b.prototype.f=function(a,b,e){this.F(a,b,e)};new b})();
